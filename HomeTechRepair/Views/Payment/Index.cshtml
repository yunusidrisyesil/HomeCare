@model PaymentViewModel
@*todo information yapılacak*@
<!-- Page Content -->
<div class="content">
    <div class="container">

        <div class="row">
            <div class="col-md-7 col-lg-8">
                <div class="card">
                    <div class="card-body">

                        <!-- Checkout Form -->
                        <form asp-action="Index" method="post">
                            <input asp-for="Installment" type="hidden" id="hdInstallment" value="1" />
                            <!-- Personal Information -->
                            <div class="info-widget">
                                <h4 class="card-title">Kişisel Bilgiler</h4>
                                <div class="row">
                                    <div class="col-md-6 col-sm-12">
                                        <div class="form-group card-label">
                                            <label>Ad</label>
                                            <input class="form-control" type="text">
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-sm-12">
                                        <div class="form-group card-label">
                                            <label>Soyad</label>
                                            <input class="form-control" type="text">
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-sm-12">
                                        <div class="form-group card-label">
                                            <label>Email</label>
                                            <input class="form-control" type="email">
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-sm-12">
                                        <div class="form-group card-label">
                                            <label>Telefon Numarası </label>
                                            <input class="form-control" type="text">
                                        </div>
                                    </div>
                                </div>
                                <div class="exist-customer">Existing Customer? <a href="#">Click here to login</a></div>
                            </div>
                            <!-- /Personal Information -->

                            <div class="payment-widget">
                                <h4 class="card-title">Ödeme Şekli</h4>

                                <!-- Credit Card Payment -->
                                <div class="payment-list">
                                    <label class="payment-radio credit-card-option">
                                        <input type="radio" name="radio" checked>
                                        <span class="checkmark"></span>
                                        Kredi Kartı
                                    </label>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group card-label">
                                                <label asp-for="CardModel.CardHolderName">Kart Üzerindeki İsim</label>
                                                <input asp-for="CardModel.CardHolderName" class="form-control" id="card_name" type="text">
                                                <span asp-validation-for="CardModel.CardHolderName"></span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group card-label">
                                                <label asp-for="CardModel.CardNumber">Kart Numarası</label>
                                                <input asp-for="CardModel.CardNumber" class="form-control" id="card_number" placeholder="1234  5678  9876  5432" type="text">
                                                <span asp-validation-for="CardModel.CardNumber"></span>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group card-label">
                                                <label asp-for="CardModel.ExpireMonth">S.K. Ay</label>
                                                <input asp-for="CardModel.ExpireMonth" class="form-control" id="expiry_month" placeholder="MM" type="text">
                                                <span asp-validation-for="CardModel.ExpireMonth"></span>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group card-label">
                                                <label asp-for="CardModel.ExpireYear">S.K. Yıl</label>
                                                <input asp-for="CardModel.ExpireYear" class="form-control" id="expiry_year" placeholder="YY" type="text">
                                                <span asp-validation-for="CardModel.ExpireYear"></span>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group card-label">
                                                <label asp-for="CardModel.Cvc">CVV</label>
                                                <input asp-for="CardModel.Cvc" class="form-control" id="cvv" type="text">
                                                <span asp-validation-for="CardModel.Cvc"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- /Credit Card Payment -->
                                <div class="col-lg-6">
                                    <div class="payment-widget">
                                        <h3 class="title">Taksit Seçenekleri </h3>
                                        <div class="payment-widget table-responsive">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th></th>
                                                        <th>Taksit Sayısı</th>
                                                        <th>Ödenecek Tutar</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="table-installment">
                                                </tbody>
                                                <input type="hidden" asp-for="PaidAmount" class="form-control" id="Price" >
                                                <span type="hidden" asp-validation-for="PaidAmount"></span>
                                            </table>
                                        </div>

                                    </div>
                                </div>
                                <!-- Terms Accept -->
                                <div class="terms-accept">
                                    <div class="custom-checkbox">
                                        <input type="checkbox" id="terms_accept">
                                        <label for="terms_accept">Kullanım Şartlarını Okudum ve Kabul ediyorum <a href="#">Kullanıcı Şartları Sözleşmesi</a></label>
                                    </div>
                                </div>
                                <!-- /Terms Accept -->
                                <!-- Submit Section -->
                                <div class="submit-section mt-4">
                                    <button type="submit" class="btn btn-primary submit-btn">Kabul et ve Öde</button>
                                </div>
                                <!-- /Submit Section -->

                            </div>
                        </form>
                        <!-- /Checkout Form -->

                    </div>
                </div>

            </div>

            <div class="col-md-5 col-lg-4 theiaStickySidebar">

                <!-- Booking Summary -->
                <div class="card booking-card">
                    <div class="card-header">
                        <h4 class="card-title">Booking Summary</h4>
                    </div>
                    <div class="card-body">

                        <!-- Booking Doctor Info -->
                        <div class="booking-doc-info">
                            <a href="doctor-profile.html" class="booking-doc-img">
                                <img src="~/assets/img/doctors/doctor-thumb-02.jpg" alt="User Image">
                            </a>
                            <div class="booking-info">
                                <h4><a href="doctor-profile.html">Dr. Darren Elder</a></h4>
                                <div class="rating">
                                    <i class="fas fa-star filled"></i>
                                    <i class="fas fa-star filled"></i>
                                    <i class="fas fa-star filled"></i>
                                    <i class="fas fa-star filled"></i>
                                    <i class="fas fa-star"></i>
                                    <span class="d-inline-block average-rating">35</span>
                                </div>
                                <div class="clinic-details">
                                    <p class="doc-location"><i class="fas fa-map-marker-alt"></i> Newyork, USA</p>
                                </div>
                            </div>
                        </div>
                        <!-- Booking Doctor Info -->

                        <div class="booking-summary">
                            <div class="booking-item-wrap">
                                <ul class="booking-date">
                                    <li>Date <span>16 Nov 2019</span></li>
                                    <li>Time <span>10:00 AM</span></li>
                                </ul>
                                <ul class="booking-fee">
                                    <li>Consulting Fee <span>$100</span></li>
                                    <li>Booking Fee <span>$10</span></li>
                                    <li>Video Call <span>$50</span></li>
                                </ul>
                                <div class="booking-total">
                                    <ul class="booking-total-list">
                                        <li>
                                            <span>Total</span>
                                            <span class="total-cost">$160</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Booking Summary -->

            </div>
        </div>

    </div>

</div>
<!-- /Page Content -->
@section Scripts
{
<script>
    $(document).ready(function() {
        console.log("Jquery OK");
        $("#card_number").keyup(function() {
            var binNumber = $(this).val();
            if (binNumber.length === 6) {
                console.log("taksit bilgisi istenecek");
            }
        });
        $("#card_number").blur(function() {
            var binNumber = $(this).val();
            if (binNumber.length >= 6 && binNumber.length <= 16) {
                console.log("taksit bilgisi istenecek: " + binNumber);
                $.ajax({
                    url: '@Url.Action("CheckInstallment", "Payment")',
                    method: 'POST',
                    data: {
                        binNumber: binNumber,
                        price: @Html.Raw(Json.Serialize(@ViewBag.PaidAmount))
                    },
                    success: function(response) {
                        fillInstallments(response.installmentPrices);
                    },
                    error: function(error) {
                        console.log(error);
                    }
                });
            }
        });
        function fillInstallments(installmentPrices) {
            $("#table-installment").empty();
            for (var i = 0; i < installmentPrices.length; i++) {
                var data = installmentPrices[i];
                console.log(data);
                var tr = document.createElement("tr");
                var td1 = document.createElement("td");
                var td2 = document.createElement("td");
                var td3 = document.createElement("td");
                var radio = document.createElement("input");
                var label = document.createElement("label");
                $(radio)
                    .attr("type", "radio")
                    .attr("name", "install-radio")
                    .attr("data", data.installmentNumber)
                    .attr("id","rd"+i)
                    .appendTo(td1);
                $(label)
                    .attr("for", "rd" + i)
                    .html(data.installmentNumber)
                    .appendTo(td1);
                $(radio).on('change', function() {
                    $("#hdInstallment").val($(this).attr("data"));
                });
                if (i == 0) {
                    $(radio).prop('checked',true);
                }
                $(td2).html(data.price);
                $(td3).html(data.totalPrice);
                $(tr).append(td1).append(td2).append(td3).appendTo($("#table-installment"));
            }
        }
    });
</script>
}